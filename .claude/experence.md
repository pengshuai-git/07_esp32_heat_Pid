# ESP32 OLED 显示问题解决经验总结

## 问题描述
OLED 屏幕无任何显示，硬件连接正常但初始化后不亮屏。

## 解决方案

### 1. 完善字模库
**问题**: 原字模库缺少 "HELLO" 中的关键字符（E、H、L、O）
**解决**: 补充完整的大写字母字模
```c
static const uint8_t Ee[5] = {0x7F,0x49,0x49,0x49,0x41};
static const uint8_t Hh[5] = {0x7F,0x08,0x08,0x08,0x7F};
static const uint8_t Ll[5] = {0x7F,0x40,0x40,0x40,0x40};
static const uint8_t Oo[5] = {0x3E,0x41,0x41,0x41,0x3E};
```

### 2. 优化 SSD1306 初始化序列
**问题**: 原初始化序列可能不兼容某些 SSD1306 模块
**解决**: 使用更通用、标准的初始化序列
```c
// 关键改进：
i2c_write_cmd(0x20); i2c_write_cmd(0x00); // 水平寻址模式（更通用）
i2c_write_cmd(0xA1); // segment remap (X轴翻转)
i2c_write_cmd(0xC8); // COM scan direction (Y轴翻转)
```

### 3. 添加 I2C 设备探测
**问题**: 无法确认 OLED 是否在线响应
**解决**: 添加设备探测日志
```c
esp_err_t probe = i2c_master_write_to_device(I2C_PORT, OLED_I2C_ADDR, &dummy, 0, 100 / portTICK_PERIOD_MS);
if (probe != ESP_OK) {
    ESP_LOGW(TAG, "OLED 0x%02X 未响应，检查I2C连线/上拉/地址", OLED_I2C_ADDR);
}
```

## 关键经验

### SSD1306 初始化要点
1. **寻址模式**: 水平寻址 `0x20,0x00` 比页寻址更通用
2. **显示方向**: `0xA1`(X翻转) + `0xC8`(Y翻转) 适配大多数模块
3. **时序**: 严格按照 datasheet 顺序发送命令
4. **电荷泵**: `0x8D,0x14` 必须启用，否则无显示

### 字模设计原则
1. **5x7 点阵**: 适合小屏幕，清晰可读
2. **垂直低位在上**: 符合 SSD1306 数据格式
3. **跨页处理**: 字符可能跨越两个页，需要分别写入
4. **字符间距**: 5列字符 + 1列间距 = 6列总宽度

### I2C 调试技巧
1. **设备探测**: 先确认设备响应，再发送初始化命令
2. **地址确认**: 默认 0x3C，部分模块为 0x3D
3. **上拉电阻**: I2C 必须上拉到 3.3V，通常 4.7kΩ
4. **时钟频率**: 400kHz 对大多数模块安全

## 常见问题排查

### 无显示
- 检查 I2C 地址（0x3C vs 0x3D）
- 确认上拉电阻和供电
- 验证初始化序列完整性

### 显示异常
- 上下/左右颠倒：调整 `0xA1/0xC8` 为 `0xA0/0xC0`
- 字符不完整：检查字模库是否包含所需字符
- 显示错位：确认寻址模式（水平 vs 页寻址）

### 性能优化
- 批量写入数据减少 I2C 传输次数
- 使用 DMA 传输大数据量
- 合理设置 I2C 时钟频率

## 后续改进建议
1. 支持更多字符集（中文、符号）
2. 添加图形绘制功能（线条、矩形）
3. 实现滚动显示
4. 支持不同尺寸 OLED（128x32, 64x48 等）
